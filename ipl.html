<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Willow FHD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/shaka-player.ui.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/controls.min.css" crossorigin="anonymous">
    <style>
        * {
            user-select: auto !important;
            -webkit-user-select: auto !important;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
        }
        
        #player-container {
            width: 100%;
            height: 100vh;
            position: relative;
        }
        
        .shaka-video-container {
            width: 100% !important;
            height: 100% !important;
        }
        
        #video {
            width: 100%;
            height: 100%;
        }
        
        #message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 1001;
        }
        
        .error-message {
            color: #ff6b6b;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div id="player-container">
        <div data-shaka-player-container style="width:100%;height:100%;">
            <video autoplay 
                   data-shaka-player 
                   id="video" 
                   poster="" 
                   style="width:100%;height:100%;"
                   controls>
            </video>
        </div>
    </div>
    
    <div id="message">
        <div class="error-message">Loading video player...</div>
    </div>

    <script>
        const manifestUri = "https://ottb.live.cf.ww.aiv-cdn.net/lhr-nitro/live/clients/dash-sd/enc/sqxzntznhn/out/v1/23fd656f4d394fffa1f2fa0bcdb21d70/cenc-sd.mpd";
        
        let player = null;
        let ui = null;
        
        async function init() {
            try {
                console.log('Initializing Shaka Player...');
                
                // Check if Shaka Player is supported
                if (!shaka.Player.isBrowserSupported()) {
                    console.error('Browser not supported!');
                    showMessage('Browser not supported for video playback');
                    return;
                }
                
                const video = document.getElementById('video');
                const playerContainer = document.querySelector('[data-shaka-player-container]');
                
                if (!video || !playerContainer) {
                    console.error('Video element or container not found');
                    showMessage('Video player initialization failed');
                    return;
                }
                
                // Create UI configuration
                const config = {
                    'controlPanelElements': ['play_pause', 'time_and_duration', 'spacer', 'mute', 'volume', 'fullscreen'],
                    'overflowMenuButtons': ['captions', 'quality', 'language', 'picture_in_picture', 'cast', 'playback_rate'],
                    'addSeekBar': true,
                    'addBigPlayButton': true,
                    'castReceiverAppId': '',
                    'castAndroidReceiverCompatible': false
                };
                
                // Initialize UI
                ui = new shaka.ui.Overlay(video, playerContainer, video);
                ui.configure(config);
                
                // Get player and controls
                const controls = ui.getControls();
                player = controls.getPlayer();
                
                // Configure player
                player.configure({
                    streaming: {
                        rebufferingGoal: 10,
                        bufferingGoal: 30,
                        bufferBehind: 30,
                        retryParameters: {
                            timeout: 30000,
                            maxAttempts: 4,
                            baseDelay: 1000,
                            backoffFactor: 2,
                            fuzzFactor: 0.5
                        }
                    },
                    drm: {
                        clearKeys: {
                            "a374d4f24f5a101203c2d714adeac805": "1a34df7de436868747bd29fab5bc7cbc"
                        }
                    },
                    manifest: {
                        retryParameters: {
                            timeout: 30000,
                            maxAttempts: 4,
                            baseDelay: 1000,
                            backoffFactor: 2,
                            fuzzFactor: 0.5
                        }
                    }
                });
                
                // Add event listeners
                player.addEventListener('error', onPlayerErrorEvent);
                player.addEventListener('loading', () => {
                    console.log('Loading...');
                    showMessage('Loading stream...');
                });
                player.addEventListener('loaded', () => {
                    console.log('Stream loaded successfully');
                    hideMessage();
                });
                player.addEventListener('buffering', (event) => {
                    if (event.buffering) {
                        console.log('Buffering...');
                    }
                });
                
                controls.addEventListener('error', onUIErrorEvent);
                
                // Load the manifest
                console.log('Loading manifest:', manifestUri);
                await player.load(manifestUri);
                console.log('The video has been loaded successfully!');
                hideMessage();
                
            } catch (error) {
                console.error('Initialization failed:', error);
                onPlayerError(error);
            }
        }
        
        function onPlayerErrorEvent(errorEvent) {
            onPlayerError(errorEvent.detail);
        }
        
        function onPlayerError(error) {
            console.error('Player Error - Code:', error.code, 'Category:', error.category, 'Object:', error);
            
            let errorMessage = 'Video playback error occurred';
            
            switch (error.category) {
                case shaka.util.Error.Category.NETWORK:
                    errorMessage = 'Network error - Check your internet connection';
                    break;
                case shaka.util.Error.Category.TEXT:
                    errorMessage = 'Subtitle/Caption error';
                    break;
                case shaka.util.Error.Category.MEDIA:
                    errorMessage = 'Media decoding error';
                    break;
                case shaka.util.Error.Category.MANIFEST:
                    errorMessage = 'Manifest parsing error';
                    break;
                case shaka.util.Error.Category.STREAMING:
                    errorMessage = 'Streaming error';
                    break;
                case shaka.util.Error.Category.DRM:
                    errorMessage = 'DRM/Encryption error';
                    break;
                case shaka.util.Error.Category.PLAYER:
                    errorMessage = 'Player error';
                    break;
                case shaka.util.Error.Category.CAST:
                    errorMessage = 'Cast error';
                    break;
                case shaka.util.Error.Category.STORAGE:
                    errorMessage = 'Storage error';
                    break;
                case shaka.util.Error.Category.ADS:
                    errorMessage = 'Advertisement error';
                    break;
            }
            
            showMessage(errorMessage + ' (Code: ' + error.code + ')');
        }
        
        function onUIErrorEvent(errorEvent) {
            onPlayerError(errorEvent.detail);
        }
        
        function initFailed(errorEvent) {
            console.error('Unable to load the UI library!', errorEvent);
            showMessage('Failed to load video player library');
        }
        
        function showMessage(text) {
            const messageDiv = document.getElementById('message');
            const errorDiv = messageDiv.querySelector('.error-message');
            errorDiv.textContent = text;
            messageDiv.style.display = 'flex';
        }
        
        function hideMessage() {
            const messageDiv = document.getElementById('message');
            messageDiv.style.display = 'none';
        }
        
        // Cleanup function
        function cleanup() {
            if (player) {
                player.destroy();
                player = null;
            }
            if (ui) {
                ui = null;
            }
        }
        
        // Event listeners
        document.addEventListener('shaka-ui-loaded', init);
        document.addEventListener('shaka-ui-load-failed', initFailed);
        window.addEventListener('beforeunload', cleanup);
        
        // Initialize when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                if (typeof shaka !== 'undefined') {
                    init();
                }
            });
        } else {
            if (typeof shaka !== 'undefined') {
                init();
            }
        }
    </script>
</body>
</html>
